<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="color-scheme" content="light" />
  <title>Infecciosas — Hub v2</title>

  <!-- Enlazado robusto (relativo) para funcionar en raíz o /Planta/ -->
  <link rel="manifest" href="/Planta/manifest.webmanifest">
<link rel="icon" type="image/png" sizes="32x32" href="/Planta/icons/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/Planta/icons/favicon-16.png">
<link rel="apple-touch-icon" href="/Planta/icons/icon-192.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">


  <style>
    /* Diseño evolutivo One UI 8: tarjetas limpias, tipografía fuerte, color clínico */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:#fff;color:#0b1220;
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      font-size:clamp(15px,1vw + .3vh,18px);line-height:1.62;min-height:100dvh;-webkit-tap-highlight-color:transparent}
    :focus-visible{outline:3px solid color-mix(in oklab, hsl(43 84% 56%), #22c55e 18%);outline-offset:2px;border-radius:10px}
    .container{max-width:min(1160px,98vw);margin:0 auto;padding:8px clamp(12px,4vw,20px);container-type:inline-size}
    header.appbar{position:sticky;top:0;z-index:50;min-height:64px;background:linear-gradient(180deg,#ffffff 50%,#f2f7ff 100%);border-bottom:1px solid #e5e7eb;backdrop-filter:saturate(1.05) blur(6px)}
    .brand{display:flex;gap:12px;align-items:center}
    .brand .title{font-size:clamp(22px,2.8vw,30px);font-weight:900;margin:0}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;font-size:.82rem;background:#f6f8fb}
    .btn{appearance:none;border:1px solid #e5e7eb;background:#fff;color:#0b1220;padding:10px 12px;border-radius:12px;min-height:44px;display:inline-flex;align-items:center;gap:8px;cursor:pointer}
    .btn.primary{background:hsl(43 84% 56%);border-color:transparent}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:20px;box-shadow:0 1px 2px rgba(2,6,23,.05),0 8px 24px rgba(2,6,23,.06);overflow:hidden}
    .card-h{padding:14px 16px;background:linear-gradient(179deg,hsl(205 85% 44%),hsl(205 82% 40%));color:#f8fafc;text-shadow:0 1px 2px rgba(0,0,0,.35);display:flex;justify-content:space-between;align-items:center}
    .card-b{padding:12px}
    .tabs{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .tab{padding:12px 14px;border-radius:14px;border:1px solid #e5e7eb;background:#f6f8fb;cursor:pointer;font-weight:900}
    nav.bottom{position:sticky;bottom:0;z-index:30;background:#fff;border-top:1px solid #e5e7eb}
    .tabs-bottom{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;align-items:center;padding:8px 12px}
    .tab-bottom{padding:10px 14px;border-radius:999px;border:1px solid #e5e7eb;background:#f6f8fb;cursor:pointer;font-weight:900}

    /* Píldoras habitación más grandes */
    .pill{display:inline-flex;align-items:center;justify-content:center;font-weight:900;font-size:clamp(18px,2.3vw,22px);padding:10px 14px;border-radius:12px;line-height:1;border:1px solid #a7f3d0;background:#eafff6;color:#083344;font-variant-numeric:tabular-nums}
    ul.list{list-style:none;padding:0;margin:0;display:grid;gap:10px}
    li.item{display:grid;grid-template-columns:auto minmax(120px,1fr) auto;gap:12px;align-items:center;border:1px solid #e5e7eb;border-radius:14px;padding:12px;background:#fff}
    .muted{color:#64748b}
    #toast{position:fixed;left:50%;bottom:14px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 2px 6px rgba(2,6,23,.18);z-index:60}
    #toast[hidden]{display:none}
  </style>
</head>
<body>
  <header class="appbar">
    <div class="container" style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
      <div class="brand"><img src="icons/icon-192.png" alt="" style="width:32px;height:32px;border-radius:8px"><h1 class="title">Infecciosas — Hub v2</h1></div>
      <div style="flex:1"></div>
      <span id="badge-online" class="chip">Offline</span>
      <span id="badge-install" class="chip">Instalación: desconocida</span>
      <button id="installBtn" class="btn">Instalar</button>
    </div>
  </header>

  <main class="container" id="app" style="display:grid;gap:12px">
    <section class="card">
      <div class="card-h"><h2 style="margin:0">Diagnóstico de instalación</h2><span id="diag-sw" class="chip">SW: —</span></div>
      <div class="card-b">
        <ul style="margin:0;padding-left:18px">
          <li><strong>Manifest:</strong> <code>manifest.webmanifest</code> (rutas relativas, `scope: "./"`)</li>
          <li><strong>Iconos:</strong> 192/512 PNG, <code>purpose: any maskable</code> + <code>monochrome</code></li>
          <li><strong>Service Worker:</strong> controlando la página y actualizado (v4.0.0)</li>
        </ul>
      </div>
    </section>

    <!-- Aquí continúa tu app (Planta, Tareas, Directorio). Conserva tu lógica previa si lo deseas. -->
    <section class="card">
      <div class="card-h"><h2 style="margin:0">Planta</h2></div>
      <div class="card-b">
        <ul class="list">
          <li class="item"><span class="pill">421-2</span><div>Ejemplo de paciente/nota</div><div></div></li>
        </ul>
      </div>
    </section>
  </main>

  <div id="toast" hidden></div>

  <script type="module">
    const $ = (s, r=document)=>r.querySelector(s);
    const toast = (m)=>{ const t=$('#toast'); t.textContent=m; t.hidden=false; setTimeout(()=>t.hidden=true,2200); };

    // Online
    function setOnline(on){ const b=$('#badge-online'); b.textContent = on ? 'Online' : 'Offline'; b.className='chip'; }
    setOnline(navigator.onLine); addEventListener('online',()=>setOnline(true)); addEventListener('offline',()=>setOnline(false));

    // PWA install prompt
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e; $('#badge-install').textContent='Instalable: sí'; 
    });
    $('#installBtn').onclick = async ()=>{ if(deferredPrompt){ deferredPrompt.prompt(); deferredPrompt=null; } else { toast('No hay prompt disponible. Si ya está instalada, desinstala y recarga.'); } };

    // Service Worker
    const diagSW = $('#diag-sw');
    if ('serviceWorker' in navigator) {
      try {
        const reg = await navigator.serviceWorker.register('./sw.js', {scope: './'});
        navigator.serviceWorker.addEventListener('controllerchange',()=>location.reload());
        diagSW.textContent = reg.active ? 'SW: activo' : 'SW: registrado';
      } catch(e){ diagSW.textContent='SW: error'; console.error(e); }
    } else {
      diagSW.textContent = 'SW: no soportado';
    }

    // Extra: comprobar que el manifest carga y los iconos responden 200
    async function checkManifest(){
      try{
        const res = await fetch('manifest.webmanifest', {cache:'no-store'});
        if(!res.ok) throw new Error('Manifest not OK: '+res.status);
        const m = await res.json();
        const icons = (m.icons||[]).map(i=>i.src);
        let okAll = true;
        for(const p of icons){
          const r = await fetch(p, {cache:'no-store'});
          okAll = okAll && r.ok;
        }
        $('#badge-install').textContent = okAll ? 'Instalación: requisitos OK' : 'Instalación: iconos no válidos';
      }catch(e){
        $('#badge-install').textContent = 'Instalación: manifest no válido';
      }
    }
    checkManifest();
  </script>
</body>
</html>
