<!doctype html>
<html lang="es" data-app-version="3.0">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#ffffff" />
  <title>Infecciosas — PWA v3.0 · Planta · Tareas · Directorio</title>

  <!-- Mantén tu manifest y service worker existentes. Ajusta la ruta si sirves en subcarpeta (p. ej., /Planta/). -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    /* =============================
       SISTEMA DE DISEÑO · TOKENS
       ============================= */
    :root {
      /* Base */
      --ui-bg: hsl(0 0% 100%);
      --ink-900: hsl(222 47% 11%);
      --ink-700: hsl(220 15% 28%);
      --ink-500: hsl(220 10% 40%);
      --muted-200: hsl(210 16% 94%);
      --muted-300: hsl(210 16% 90%);

      /* Estados cromáticos (psicológicos) */
      --amber-500: hsl(38 100% 58%);
      --amber-600: hsl(34 100% 50%);
      --emerald-500: hsl(145 65% 36%);
      --emerald-600: hsl(158 65% 42%);
      --cobalt-500: hsl(215 90% 54%);
      --indigo-600: hsl(244 63% 52%);

      /* Gradientes semánticos */
      --grad-pending: linear-gradient(135deg, var(--amber-500), var(--amber-600));
      --grad-done:    linear-gradient(135deg, var(--emerald-500), var(--emerald-600));
      --grad-info:    linear-gradient(135deg, var(--cobalt-500), var(--indigo-600));

      /* Gradientes por pestaña */
      --grad-planta:      linear-gradient(135deg, hsl(190 80% 42%), hsl(162 67% 45%));
      --grad-tareas-pend: var(--grad-pending);
      --grad-tareas-done: var(--grad-done);
      --grad-directorio:  linear-gradient(135deg, hsl(230 60% 52%), hsl(258 60% 54%));

      /* Rim light / elevación */
      --rim: inset 0 0 0 1px hsl(0 0% 100% / .72), 0 1px 2px hsl(220 5% 0% / .06), 0 8px 24px hsl(220 10% 20% / .08);

      /* Tipografía fluida (One UI-like) */
      --fs-h1: clamp(1.25rem, 1.1rem + 2vw, 2rem);
      --fs-h2: clamp(1.10rem, 1.0rem + 1.5vw, 1.35rem);
      --fs-body: clamp(.95rem, .9rem + .5vw, 1.05rem);
      --fs-meta: clamp(.8rem, .75rem + .25vw, .9rem);

      /* Radios y espaciado */
      --radius-xl: 20px; --radius-lg: 16px; --radius-md: 12px; --radius-sm: 10px;
      --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px; --space-5: 24px; --space-6: 32px; --space-7: 48px;

      /* Layout máx. */
      --max-w: 1200px;
    }

    /* Reset y base */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--ui-bg); color:var(--ink-900);
      font: 500 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    img,svg{display:block; max-width:100%}
    a{color:inherit; text-decoration:none}
    button{font:inherit}
    :focus-visible{outline:2px solid hsl(0 0% 100% / .9); outline-offset:2px}
    @media (prefers-reduced-motion: no-preference){
      .ui-animate{transition: all .24s cubic-bezier(.2,.6,.2,1)}
    }

    /* Safe areas (Android / notches) */
    .ui-safe-area{padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}

    /* Contenedor principal con container queries */
    .ui-app{min-height:100dvh; display:flex; flex-direction:column}
    .ui-wrap{width:100%; max-width:var(--max-w); margin-inline:auto; padding-inline:clamp(12px, 2vw, 20px)}
    .ui-main{flex:1; container-type:inline-size; container-name:app}

    /* APP BAR (top) */
    .ui-topbar{position:sticky; top:0; z-index:40; background:var(--ui-bg);
      box-shadow: var(--rim); border-bottom: 1px solid var(--muted-300)}
    .ui-topbar-inner{display:flex; align-items:center; gap:12px; padding: 10px 14px}
    .ui-brand{display:flex; align-items:center; gap:10px}
    .ui-brand svg{width:28px;height:28px}
    .ui-title{font-size:var(--fs-h2); font-weight:700}
    .ui-spacer{flex:1}
    .ui-chip{display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; box-shadow:var(--rim)}
    .ui-avatar{width:22px;height:22px;border-radius:50%; background:var(--muted-300)}
    .ui-btn{border:0; background:transparent; padding:6px 10px; border-radius:10px; cursor:pointer}
    .ui-btn-primary{color:#111; background: color-mix(in srgb, white 65%, var(--cobalt-500)); box-shadow:var(--rim)}

    /* TABS (cabecera de navegación) */
    .ui-tabs{position:sticky; top:52px; z-index:30; background:var(--ui-bg); border-bottom:1px solid var(--muted-300)}
    .ui-tablist{display:flex; gap:8px; padding:8px 14px}
    .ui-tab{appearance:none; border:0; border-radius:12px; padding:10px 14px; display:flex; align-items:center; gap:10px; cursor:pointer; color:var(--ink-700); background:transparent}
    .ui-tab[aria-selected="true"]{color:#111; background: color-mix(in srgb, white 75%, var(--muted-300)); box-shadow: var(--rim)}
    .ui-tab svg{width:18px; height:18px}

    /* SECCIÓN/HERO por pestaña con gradiente + rim light */
    .ui-hero{border-radius: var(--radius-xl); padding: 16px; margin: 16px; color:white; position:relative; overflow:hidden; box-shadow: var(--rim)}
    .ui-hero::after{content:""; position:absolute; inset:0; background:radial-gradient(70% 70% at 80% 20%, hsl(0 0% 100% / .25), transparent)}
    .ui-hero-title{font-size: var(--fs-h1); font-weight:800; letter-spacing:.2px}
    .ui-hero-meta{font-size: var(--fs-meta); opacity:.95}

    /* Tarjetas, listas y chips */
    .ui-grid{display:grid; gap:16px; padding: 0 16px 24px}
    @container app (min-width: 800px){ .ui-grid{grid-template-columns: repeat(2, minmax(0,1fr))} }
    @container app (min-width: 1100px){ .ui-grid{grid-template-columns: repeat(3, minmax(0,1fr))} }

    .ui-card{background:var(--ui-bg); border-radius: var(--radius-lg); box-shadow: var(--rim); padding:14px}
    .ui-card h3{margin:0 0 6px; font-size:1.05rem}
    .ui-meta{color:var(--ink-500); font-size:var(--fs-meta)}

    .ui-chip-state{display:inline-flex; align-items:center; gap:8px; border-radius:999px; padding:6px 10px; color:#1b1b1b; background:white; box-shadow: var(--rim)}
    .ui-chip-pending{background-image: var(--grad-pending); color:#1b1b1b}
    .ui-chip-done{background-image: var(--grad-done); color:white}
    .ui-chip-info{background-image: var(--grad-info); color:white}

    .ui-divider{height:2px; background:linear-gradient(90deg, white, color-mix(in srgb, white 25%, var(--cobalt-500)), white); border-radius:999px; box-shadow: var(--rim);}

    /* DIRECTORIO: encabezado de grupo */
    .ui-group{border-radius: var(--radius-lg); overflow:hidden; box-shadow: var(--rim)}
    .ui-group-hd{padding:10px 14px; color:white; background: var(--grad-info)}
    .ui-list{margin:0; padding:0; list-style:none}
    .ui-li{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 14px; border-top:1px solid var(--muted-300)}

    /* TARJETAS DEMO DE TAREAS (visual, no lógica de datos) */
    .ui-task{display:flex; align-items:center; gap:12px}
    .ui-task .ui-check{width:20px;height:20px;border-radius:6px; box-shadow:var(--rim); background:white; display:grid; place-items:center}
    .ui-task.done .ui-check{background: color-mix(in srgb, white 30%, var(--emerald-600)); color:white}
    .ui-task-title{font-weight:600}
    .ui-task.done .ui-task-title{opacity:.9}

    /* FAB ejemplo (opcional) */
    .ui-fab{position:fixed; right:20px; bottom:calc(20px + env(safe-area-inset-bottom)); display:inline-flex; align-items:center; gap:10px; padding:12px 16px; color:#111; background: color-mix(in srgb, white 65%, var(--cobalt-500)); border-radius:999px; box-shadow: var(--rim); cursor:pointer}
    .ui-fab svg{width:18px;height:18px}

    /* Utilidades */
    .sr-only{position:absolute!important;width:1px!important;height:1px!important;padding:0!important;margin:-1px!important;overflow:hidden!important;clip:rect(0,0,0,0)!important;white-space:nowrap!important;border:0!important}
    .mt-0{margin-top:0}.mb-0{margin-bottom:0}.mb-1{margin-bottom:6px}.mb-2{margin-bottom:10px}.mb-3{margin-bottom:16px}

    /* HERO gradientes específicos (aplicados por pestaña) */
    #hero-planta{background: var(--grad-planta)}
    #hero-tareas[data-mode="pend"]{background: var(--grad-tareas-pend)}
    #hero-tareas[data-mode="done"]{background: var(--grad-tareas-done)}
    #hero-directorio{background: var(--grad-directorio)}
  </style>
</head>
<body class="ui-safe-area">
  <!-- SPRITE SVG · Iconografía minimal médico-naútica (original, sin IP) -->
  <svg xmlns="http://www.w3.org/2000/svg" class="sr-only">
    <symbol id="ic-estetoscopio" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <path d="M6 3v5a4 4 0 1 0 8 0V3"/>
      <path d="M6 8a6 6 0 0 0 12 0"/>
      <path d="M18 14a3 3 0 1 0 3 3v-5"/>
      <path d="M10 16v2a4 4 0 0 0 8 0v-1"/>
    </symbol>
    <symbol id="ic-check" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 6 9 17l-5-5"/>
    </symbol>
    <symbol id="ic-reloj" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"/>
      <path d="M12 7v5l3 2"/>
    </symbol>
    <symbol id="ic-auricular" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 12a8 8 0 0 1 16 0"/>
      <path d="M4 12v4a2 2 0 0 0 2 2h2v-5H6"/>
      <path d="M20 12v4a2 2 0 0 1-2 2h-2v-5h2"/>
    </symbol>
    <symbol id="ic-cama" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 17V7"/>
      <path d="M3 12h12a6 6 0 0 1 6 6v-1"/>
      <rect x="5" y="9" width="4" height="2" rx="1"/>
    </symbol>
    <symbol id="ic-plus" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 5v14M5 12h14"/>
    </symbol>
  </svg>

  <div class="ui-app">
    <!-- TOP BAR -->
    <header class="ui-topbar ui-animate" role="banner">
      <div class="ui-topbar-inner ui-wrap">
        <div class="ui-brand">
          <svg aria-hidden="true"><use href="#ic-estetoscopio"/></svg>
          <div class="ui-title">Unidad de Enfermedades Infecciosas</div>
        </div>
        <div class="ui-spacer"></div>
        <!-- Chip de usuario (placeholders para tu lógica actual de Auth) -->
        <div class="ui-chip" id="authChip" aria-live="polite">
          <div class="ui-avatar" id="userAvatar" aria-hidden="true"></div>
          <span id="userName" class="ui-meta">Invitado</span>
        </div>
        <button class="ui-btn ui-btn-primary ui-animate" id="btnGoogleSign" type="button" aria-label="Iniciar sesión con Google">Acceder</button>
        <button class="ui-btn ui-animate" id="btnGoogleOut" type="button" aria-label="Cerrar sesión" hidden>Salir</button>
      </div>
    </header>

    <!-- TABS NAV -->
    <nav class="ui-tabs ui-animate" role="navigation" aria-label="Secciones">
      <div class="ui-tablist ui-wrap" role="tablist" aria-orientation="horizontal">
        <button class="ui-tab" role="tab" aria-selected="true" aria-controls="panel-planta" id="tab-planta">
          <svg aria-hidden="true"><use href="#ic-cama"/></svg>
          <span>Planta</span>
        </button>
        <button class="ui-tab" role="tab" aria-selected="false" aria-controls="panel-tareas" id="tab-tareas">
          <svg aria-hidden="true"><use href="#ic-reloj"/></svg>
          <span>Tareas</span>
        </button>
        <button class="ui-tab" role="tab" aria-selected="false" aria-controls="panel-directorio" id="tab-directorio">
          <svg aria-hidden="true"><use href="#ic-auricular"/></svg>
          <span>Directorio</span>
        </button>
      </div>
    </nav>

    <main class="ui-main">
      <!-- PLANTA -->
      <section id="panel-planta" role="tabpanel" aria-labelledby="tab-planta">
        <div id="hero-planta" class="ui-hero ui-wrap ui-animate">
          <div class="ui-hero-title">Planta</div>
          <div class="ui-hero-meta">Pacientes, habitaciones y seguimiento diario</div>
        </div>

        <div class="ui-grid">
          <!-- Tarjetas demo (sustituye con tu contenido dinámico existente) -->
          <article class="ui-card">
            <h3 class="mb-1">Visita de la mañana</h3>
            <p class="ui-meta mb-2">Repasar analíticas y cultivos · 08:30</p>
            <div class="ui-divider mb-2"></div>
            <p class="mb-0">Optimiza la legibilidad de números de habitación y contrasta etiquetas.</p>
          </article>
          <article class="ui-card">
            <h3 class="mb-1">Interconsultas</h3>
            <p class="ui-meta mb-2">UCI · Traumatología · Medicina Interna</p>
            <div class="ui-divider mb-2"></div>
            <p class="mb-0">Mantén la estabilidad de sincronización Firestore entre dispositivos.</p>
          </article>
        </div>
      </section>

      <!-- TAREAS -->
      <section id="panel-tareas" role="tabpanel" aria-labelledby="tab-tareas" hidden>
        <div id="hero-tareas" class="ui-hero ui-wrap ui-animate" data-mode="pend" aria-live="polite">
          <div class="ui-hero-title">Tareas</div>
          <div class="ui-hero-meta">Estados cromáticos: <strong>Pendiente</strong> / Completada</div>
        </div>

        <div class="ui-wrap" style="padding-inline:16px; margin-bottom:8px; display:flex; gap:8px; align-items:center">
          <span class="ui-meta" id="tareasFiltroLabel">Vista:</span>
          <div role="group" aria-labelledby="tareasFiltroLabel" style="display:flex; gap:8px">
            <button type="button" class="ui-btn ui-btn-primary ui-animate" data-mode="pend">Pendientes</button>
            <button type="button" class="ui-btn ui-animate" data-mode="done">Completadas</button>
          </div>
        </div>

        <div class="ui-grid">
          <article class="ui-card">
            <div class="ui-task">
              <div class="ui-check" aria-hidden="true"></div>
              <div>
                <div class="ui-task-title">Revisar antibiograma (H. 312)</div>
                <div class="ui-meta">Prioriza optimización de pauta según PK/PD</div>
              </div>
            </div>
            <div class="mb-2"></div>
            <span class="ui-chip-state ui-chip-pending" aria-label="Pendiente"><svg width="16" height="16" aria-hidden="true"><use href="#ic-reloj"/></svg> Pendiente</span>
          </article>

          <article class="ui-card">
            <div class="ui-task done">
              <div class="ui-check"><svg width="14" height="14" aria-hidden="true"><use href="#ic-check"/></svg></div>
              <div>
                <div class="ui-task-title">Vacunas pre-trasplante</div>
                <div class="ui-meta">Checklist completado</div>
              </div>
            </div>
            <div class="mb-2"></div>
            <span class="ui-chip-state ui-chip-done" aria-label="Completada"><svg width="16" height="16" aria-hidden="true"><use href="#ic-check"/></svg> Hecha</span>
          </article>

          <article class="ui-card">
            <div class="ui-task">
              <div class="ui-check" aria-hidden="true"></div>
              <div>
                <div class="ui-task-title">Contactar Microbiología</div>
                <div class="ui-meta">Ajustar panel de PCR</div>
              </div>
            </div>
            <div class="mb-2"></div>
            <span class="ui-chip-state ui-chip-pending" aria-label="Pendiente"><svg width="16" height="16" aria-hidden="true"><use href="#ic-reloj"/></svg> Pendiente</span>
          </article>
        </div>
      </section>

      <!-- DIRECTORIO -->
      <section id="panel-directorio" role="tabpanel" aria-labelledby="tab-directorio" hidden>
        <div id="hero-directorio" class="ui-hero ui-wrap ui-animate">
          <div class="ui-hero-title">Directorio</div>
          <div class="ui-hero-meta">Grupos con encabezado cromático y divisor con rim light</div>
        </div>

        <div class="ui-grid">
          <section class="ui-group">
            <header class="ui-group-hd">
              <strong>Hospital</strong>
            </header>
            <ul class="ui-list">
              <li class="ui-li">
                <div>
                  <div>Centralita</div>
                  <div class="ui-meta">+34 968 000 000</div>
                </div>
                <span class="ui-chip-state ui-chip-info"><svg width="16" height="16" aria-hidden="true"><use href="#ic-auricular"/></svg> Llamar</span>
              </li>
              <li class="ui-li">
                <div>
                  <div>UCI</div>
                  <div class="ui-meta">Ext. 1234</div>
                </div>
                <span class="ui-chip-state ui-chip-info">Contacto</span>
              </li>
            </ul>
          </section>

          <section class="ui-group">
            <header class="ui-group-hd">
              <strong>Microbiología</strong>
            </header>
            <ul class="ui-list">
              <li class="ui-li">
                <div>
                  <div>Micro — Laboratorio</div>
                  <div class="ui-meta">Ext. 2211</div>
                </div>
                <span class="ui-chip-state ui-chip-info">Contacto</span>
              </li>
              <li class="ui-li">
                <div>
                  <div>Micro — Guardias</div>
                  <div class="ui-meta">Móvil 600 000 000</div>
                </div>
                <span class="ui-chip-state ui-chip-info">Guardia</span>
              </li>
            </ul>
          </section>
        </div>
      </section>
    </main>

    <!-- FAB ejemplo (no interfiere con tu lógica) -->
    <button class="ui-fab ui-animate" id="fabAdd" aria-label="Añadir">
      <svg aria-hidden="true"><use href="#ic-plus"/></svg>
      <span>Nuevo</span>
    </button>

    <footer class="ui-wrap" style="padding-block:24px; color:var(--ink-500)">
      <small>v3.0 · UI premium con degradados y rim light · Mantiene estabilidad de Firebase/Auth/Firestore</small>
    </footer>
  </div>

  <script>
    // =============================
    // JS UI (Sólo visual). No toca lógica de datos/Auth/Firestore.
    // =============================
    (function(){
      const $ = (sel, el=document) => el.querySelector(sel);
      const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

      // Tabs accesibles
      const tabs = $$('.ui-tab');
      const panels = ['panel-planta','panel-tareas','panel-directorio'].map(id=>document.getElementById(id));

      function selectTab(btn){
        tabs.forEach(t=>t.setAttribute('aria-selected', String(t===btn)));
        panels.forEach(p=> p.hidden = (p.id !== btn.getAttribute('aria-controls')));
        // Enfoca el panel seleccionado para lectores de pantalla
        const panel = document.getElementById(btn.getAttribute('aria-controls'));
        panel.setAttribute('tabindex','-1'); panel.focus({preventScroll:true});
      }

      tabs.forEach(t=>{
        t.addEventListener('click', ()=>selectTab(t));
        t.addEventListener('keydown', (e)=>{
          const idx = tabs.indexOf(t);
          if(e.key==='ArrowRight'){ e.preventDefault(); tabs[(idx+1)%tabs.length].focus(); }
          if(e.key==='ArrowLeft'){ e.preventDefault(); tabs[(idx-1+tabs.length)%tabs.length].focus(); }
        });
      });

      // Filtro visual de Tareas → cambia gradiente del hero
      const heroT = document.getElementById('hero-tareas');
      $$('#panel-tareas [data-mode]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const mode = btn.getAttribute('data-mode');
          heroT.setAttribute('data-mode', mode === 'done' ? 'done' : 'pend');
          // feedback accesible
          const txt = mode==='done' ? 'Completadas' : 'Pendientes';
          heroT.querySelector('.ui-hero-meta').innerHTML = `Estados cromáticos: <strong>${txt}</strong>`;
        });
      });

      // Placeholders mínimos para no romper tu código: expone IDs comunes
      window.ui = window.ui || {};
      ui.el = {
        authChip: document.getElementById('authChip'),
        userName: document.getElementById('userName'),
        userAvatar: document.getElementById('userAvatar'),
        btnGoogleSign: document.getElementById('btnGoogleSign'),
        btnGoogleOut: document.getElementById('btnGoogleOut'),
        fabAdd: document.getElementById('fabAdd'),
      };

      // Registrar SW si ya tienes uno en el proyecto (idempotente)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistration().then(reg=>{
          if(!reg){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
        }).catch(()=>{});
      }

      // Ajuste visual: botón Acceder/Salir demoscópico (no Auth real)
      ui.el.btnGoogleSign?.addEventListener('click', ()=>{
        ui.el.userName.textContent = 'Dr. Infecciosas';
        ui.el.btnGoogleSign.hidden = true;
        ui.el.btnGoogleOut.hidden = false;
        ui.el.userAvatar.style.background = 'linear-gradient(135deg, #9be15d, #00e3ae)';
      });
      ui.el.btnGoogleOut?.addEventListener('click', ()=>{
        ui.el.userName.textContent = 'Invitado';
        ui.el.btnGoogleSign.hidden = false;
        ui.el.btnGoogleOut.hidden = true;
        ui.el.userAvatar.style.background = '';
      });
    })();
  </script>
</body>
</html>
